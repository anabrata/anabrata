<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>World of PDFs • PDF → Word (Exact Look) • Made by ANABRATA</title>
<meta name="color-scheme" content="light dark" />
<style>
  :root{
    --green:#10b981; --yellow:#fde047; --blue:#3b82f6; --pink:#f9a8d4;
    --card:#ffffffee; --text:#0b1020; --muted:#4b5563; --ring:rgba(0,0,0,.12);
    --grad: linear-gradient(135deg, var(--green), var(--blue), var(--yellow));
  }
  body{
    margin:0; font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif; color:var(--text);
    background:
      radial-gradient(1200px 800px at 10% 10%, rgba(16,185,129,.22), transparent 60%),
      radial-gradient(1200px 800px at 90% 20%, rgba(59,130,246,.22), transparent 60%),
      radial-gradient(1200px 800px at 50% 100%, rgba(253,224,71,.22), transparent 60%),
      linear-gradient(120deg, #e8fdf6, #eef4ff 40%, #fffbe6 80%, #ffffff);
    background-size:140% 140%; animation:bgShift 18s ease-in-out infinite alternate;
  }
  @keyframes bgShift{0%{background-position:0% 0%, 100% 0%, 50% 100%, 0% 0%}100%{background-position:50% 30%, 50% 20%, 60% 70%, 100% 100%}}
  .wrap{ width:min(1200px,94%); margin:0 auto; position:relative; z-index:1 }
  header.hero{ min-height:28vh; display:grid; place-items:center; text-align:center; padding: clamp(1.4rem,5vw,2.6rem) 0 1rem; }
  .welcome{
    font-weight:900; letter-spacing:.05em; line-height:1.1;
    background:linear-gradient(90deg, var(--green), var(--blue), var(--yellow), var(--pink), var(--green));
    -webkit-background-clip:text; background-clip:text; color:transparent;
    background-size:220% 100%; animation: hue 14s linear infinite, fadeInOut 8s ease-in-out infinite;
    font-size: clamp(1.2rem, 4.2vw, 2.4rem);
  }
  @keyframes hue{0%{background-position:0% 50%}100%{background-position:220% 50%}}
  @keyframes fadeInOut{0%{opacity:0}18%{opacity:1}82%{opacity:1}100%{opacity:0}}
  .byline{ margin-top:.5rem; font-weight:800; color:#0b1020; display:inline-block; padding:.35rem .7rem; border-radius:.7rem;
           background:linear-gradient(90deg, rgba(16,185,129,.18), rgba(59,130,246,.18), rgba(253,224,71,.18));
           box-shadow:0 6px 22px rgba(16,185,129,.14), 0 4px 16px rgba(59,130,246,.12) }
  .shiny{
    position:relative; width:min(900px, 96%); margin:0 auto 1rem; border-radius:22px; padding:1.4rem;
    background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.90));
    border:1px solid rgba(255,255,255,0.7); box-shadow:0 24px 60px rgba(59,130,246,0.28), 0 16px 40px rgba(16,185,129,0.24), inset 0 1px 0 rgba(255,255,255,0.7);
    backdrop-filter: blur(12px); overflow:hidden; text-align:center;
  }
  .shiny::before{
    content:""; position:absolute; inset:-60% -40% auto -40%; height:220%; width:180%;
    background: linear-gradient(120deg, rgba(255,255,255,0.55) 0%, rgba(255,255,255,0.08) 55%, rgba(255,255,255,0) 75%);
    transform: translateX(-60%) rotate(18deg); animation: sheen 7s linear infinite; mix-blend-mode: screen; pointer-events:none;
  }
  @keyframes sheen{0%{transform:translateX(-60%) rotate(18deg)}100%{transform:translateX(60%) rotate(18deg)}}
  .row{ display:flex; gap:.9rem; align-items:center; flex-wrap:wrap; justify-content:center }
  .btn{
    background:var(--grad); color:#073b2b; border:0; padding:.9rem 1.2rem; border-radius:1rem; font-weight:900; cursor:pointer;
    box-shadow:0 8px 22px rgba(16,185,129,.22), 0 4px 14px rgba(59,130,246,.14); font-size:1.02rem
  }
  .btn.ghost{ background:linear-gradient(135deg, rgba(16,185,129,.12), rgba(59,130,246,.12)); color:#0b1020; border:1px solid var(--ring) }
  .field{ display:flex; align-items:center; gap:.5rem; background:#f8fafc; border:1px solid #e5e7eb; border-radius:.9rem; padding:.55rem .75rem }
  .muted{ color:#4b5563 }
  .panel{ background:var(--card); border:1px solid var(--ring); border-radius:14px; padding:1rem; box-shadow:0 10px 28px rgba(0,0,0,.08) }
  progress{ width:100% }
  .info{ text-align:center; color:#111827; opacity:.9; margin:1.2rem 0 2.2rem }
</style>
</head>
<body>
  <header class="hero">
    <div class="wrap">
      <div class="welcome">WELCOME TO THE WORLD OF PDFs</div>
      <div class="byline">Made by ANABRATA</div>
    </div>
  </header>

  <main class="wrap">
    <section class="shiny">
      <div style="font-weight:900; font-size:1.15rem">PDF → Word (exact same look)</div>
      <div class="muted" style="margin-top:.15rem">Each PDF page is rendered to a high‑resolution image and placed into a .docx page sized to match.</div>
      <div class="row" style="margin-top:.8rem">
        <button class="btn" id="pick">Choose PDF</button>
        <button class="btn ghost" id="convert" disabled>Convert → DOCX</button>
        <a id="download" class="btn ghost" download="converted.docx" href="#" aria-disabled="true">Download DOCX</a>
      </div>
      <div class="row" style="margin-top:.8rem">
        <div class="field"><span>Quality</span>
          <select id="dpi">
            <option value="120">Balanced (120 DPI)</option>
            <option value="150" selected>Sharp (150 DPI)</option>
            <option value="200">Extra (200 DPI)</option>
          </select>
        </div>
        <div class="muted">Higher DPI = larger .docx but sharper pages.</div>
      </div>
      <input id="file" type="file" accept="application/pdf" hidden>
      <div style="margin-top:.8rem" class="panel">
        <progress id="prog" value="0" max="100" hidden></progress>
        <div id="note" class="muted" style="margin-top:.35rem; min-height:1.2em"></div>
      </div>
    </section>

    <section class="panel" style="margin-top:1rem">
      <div style="font-weight:800; margin-bottom:.4rem">About the “exact look” method</div>
      <div class="muted">
        This guarantees visual identity in Word across devices. If editable text is required, a server converter is needed and won’t be 100% identical.
      </div>
    </section>

    <div class="info">© <span id="year"></span> Made by ANABRATA</div>
  </main>

  <!-- pdf.js (UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
  <script>
    window.pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js";
  </script>
  <!-- docx (UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.js"></script>

<script>
document.getElementById('year').textContent = new Date().getFullYear();

const pickBtn = document.getElementById('pick');
const fileIn  = document.getElementById('file');
const convertBtn = document.getElementById('convert');
const downloadA  = document.getElementById('download');
const note = document.getElementById('note');
const prog = document.getElementById('prog');
const dpiSel = document.getElementById('dpi');

let pdfFile = null;

pickBtn.onclick = () => fileIn.click();
fileIn.onchange = () => {
  if (!fileIn.files || !fileIn.files[0]) return;
  pdfFile = fileIn.files[0];
  convertBtn.disabled = false;
  note.textContent = `Selected: ${pdfFile.name}`;
};

// Units
const PT_PER_IN = 72;
const TWIPS_PER_IN = 1440;
const MM_PER_IN = 25.4;
const TWIPS_PER_MM = TWIPS_PER_IN / MM_PER_IN;

function mmToTwips(mm){ return Math.round(mm * TWIPS_PER_MM); }

function canvasToJPEGArrayBuffer(canvas, quality=0.92){
  return new Promise((resolve, reject) => {
    if (canvas.toBlob){
      canvas.toBlob(async (blob) => {
        if (!blob) return reject(new Error("Canvas toBlob failed"));
        const buf = await blob.arrayBuffer();
        resolve(buf);
      }, 'image/jpeg', quality);
    } else {
      const dataURL = canvas.toDataURL('image/jpeg', quality);
      const byteString = atob(dataURL.split(',')[1]);
      const ab = new ArrayBuffer(byteString.length);
      const ia = new Uint8Array(ab);
      for (let i=0; i<byteString.length; i++) ia[i] = byteString.charCodeAt(i);
      resolve(ab);
    }
  });
}

async function canvasFromPdfPage(page, dpi){
  const [x0, y0, x1, y1] = page.view; // points
  const widthInches  = (x1 - x0) / PT_PER_IN;
  const heightInches = (y1 - y0) / PT_PER_IN;

  // Render at desired DPI (pdf.js baseline = 96 CSS px/in)
  const scale = dpi / 96;
  const viewport = page.getViewport({ scale });

  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d', { willReadFrequently: false });
  canvas.width = Math.ceil(viewport.width);
  canvas.height = Math.ceil(viewport.height);

  const renderTask = page.render({ canvasContext: ctx, viewport, intent: 'print' });
  await renderTask.promise;

  return { canvas, widthInches, heightInches };
}

async function buildDocxFromCanvases(pages, marginsMM){
  const { Document, Packer, Paragraph, AlignmentType, ImageRun } = window.docx;

  const doc = new Document({ sections: [] });
  const marginTw = mmToTwips(marginsMM);

  for (let i=0; i<pages.length; i++){
    const { canvas, widthInches, heightInches } = pages[i];

    const pageWtw = Math.round(widthInches  * TWIPS_PER_IN);
    const pageHtw = Math.round(heightInches * TWIPS_PER_IN);

    // Content area (page minus margins) measured in Word's 96px/inch
    const contentWtw = Math.max(0, pageWtw - 2*marginTw);
    const contentHtw = Math.max(0, pageHtw - 2*marginTw);
    const contentWin  = contentWtw / TWIPS_PER_IN;
    const contentHin  = contentHtw / TWIPS_PER_IN;
    const targetPxW = Math.floor(contentWin * 96);
    const targetPxH = Math.floor(contentHin * 96);

    // Scale canvas to fit content area
    const scale = Math.min(targetPxW / canvas.width, targetPxH / canvas.height);
    const drawW = Math.max(1, Math.floor(canvas.width * scale));
    const drawH = Math.max(1, Math.floor(canvas.height * scale));

    const imgBuf = await canvasToJPEGArrayBuffer(canvas, 0.92);
    const imgRun = new ImageRun({
      data: new Uint8Array(imgBuf),
      transformation: { width: drawW, height: drawH } // pixels; docx converts to EMU internally
    });

    doc.addSection({
      properties: {
        page: {
          size:   { width: pageWtw, height: pageHtw },
          margin: { top: marginTw, right: marginTw, bottom: marginTw, left: marginTw }
        }
      },
      children: [ new Paragraph({ children: [imgRun], alignment: AlignmentType.CENTER }) ]
    });
  }

  const blob = await window.docx.Packer.toBlob(doc);
  return blob;
}

convertBtn.onclick = async () => {
  const pdfjsLib = window.pdfjsLib;
  if (!pdfjsLib || !window.docx){
    note.textContent = "Libraries failed to load. Check your internet and refresh.";
    return;
  }

  try{
    if (!pdfFile){ note.textContent = "Please choose a PDF first."; return; }
    convertBtn.disabled = true;
    downloadA.setAttribute('aria-disabled','true'); downloadA.removeAttribute('href');
    prog.hidden = false; prog.value = 5; note.textContent = "Loading PDF…";

    const arrayBuf = await pdfFile.arrayBuffer();
    const loadingTask = pdfjsLib.getDocument({ data: arrayBuf });
    const pdf = await loadingTask.promise;

    const dpi = parseInt(dpiSel.value, 10);
    const pages = [];
    const total = pdf.numPages;

    for (let p=1; p<=total; p++){
      note.textContent = `Rendering page ${p}/${total}…`;
      prog.value = Math.round(5 + (p/total)*70);
      const page = await pdf.getPage(p);
      const rendered = await canvasFromPdfPage(page, dpi);
      pages.push(rendered);
      page.cleanup(); // free resources
    }

    note.textContent = "Building Word file…";
    prog.value = 90;

    const docxBlob = await buildDocxFromCanvases(pages, 10); // 10 mm margins
    const url = URL.createObjectURL(docxBlob);
    downloadA.href = url;
    downloadA.setAttribute('aria-disabled','false');

    prog.value = 100; note.textContent = "Done. Click Download DOCX. Open in Word at 100% zoom.";
  } catch(err){
    console.error(err);
    const msg = (err && err.message) ? err.message : String(err);
    if (/Password required|Unsupported encryption/i.test(msg)){
      note.textContent = "This PDF is encrypted/password‑protected. Please unlock it before converting.";
    } else if (/NetworkError|Failed to fetch/i.test(msg)){
      note.textContent = "Could not fetch library or file. Check your connection and try again.";
    } else {
      note.textContent = "Conversion failed: " + msg;
    }
  } finally {
    prog.hidden = true;
    convertBtn.disabled = false;
  }
};
</script>
</body>
</html>
