<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Candle Timer — V10 Professional</title>

  <style>
    /* Root variables and base */
    :root {
      --digit-w: 110px;
      --digit-h: 160px;
      --digit-radius: 18px;
      --split-line: rgba(255 255 255 / 0.15);

      --bg-c1: #50386a;
      --bg-c2: #a364a6;
      --bg-c3: #fabcaf;

      --clock-c1: #fff;
      --clock-c2: #ffe6e3;
      --clock-c3: #ffb8b5;
      --clock-text: #3b0a0a;
      --colon-color: #873131;
      --clock-glass-bg: rgba(255 255 255 / 0.12);
      --clock-glass-border: rgba(255 255 255 / 0.25);

      --simple-timer-color: #b94141;

      --wax: #fde8d7;
      --wick: #2a1f1f;

      --candle-offset: 20px;

      --todo-bg: rgba(255 255 255 / 0.12);
    }

    /* Reset and base styles */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    html, body {
      margin:0; padding:0; height:100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, var(--bg-c1), var(--bg-c2), var(--bg-c3));
      background-attachment: fixed;
      background-size: cover;
      color: var(--clock-text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .brand {
      position: fixed; top: 12px; left: 12px;
      font-weight: 900; font-size: 16px;
      letter-spacing: 0.2em;
      color: #fff;
      text-shadow: 1px 1px 4px rgba(0,0,0,0.6);
      user-select: none;
      z-index: 30;
    }

    /* Main grid layout: Clock | To-do | Candle */
    .main {
      display: grid;
      grid-template-columns: max-content minmax(260px, 1fr) max-content;
      gap: clamp(24px, 5vw, 56px);
      align-items: center;
      padding: 24px min(5vw,48px);
      height: 82vh;
      max-width: 1200px;
      margin: 80px auto 0;
      user-select: none;
    }
    .main > section {
      min-width: 0; min-height: 0;
    }

    /* -------------- Flip Clock -------------- */
    #timer {
      display: flex;
      gap: 12px;
      user-select:none;
    }
    .digit {
      position: relative;
      width: var(--digit-w);
      height: var(--digit-h);
      perspective: 1100px;
      border-radius: var(--digit-radius);
      background: linear-gradient(145deg, var(--clock-c1), var(--clock-c2), var(--clock-c3));
      background-blend-mode: screen;
      border: 1px solid var(--clock-glass-border);
      backdrop-filter: blur(10px);
      box-shadow:
        inset 0 -1px 0 rgba(0,0,0,0.06),
        inset 0 1px 0 rgba(255,255,255,0.15),
        0 10px 30px rgba(0,0,0,0.25);
      flex-shrink: 0;
      cursor: default;
      transition: box-shadow 0.3s ease;
      font-weight: 900;
      color: var(--clock-text);
      font-size: calc(var(--digit-h) * 0.66);
      line-height: var(--digit-h);
      display: flex;
      align-items: center;
      justify-content: center;
      text-shadow:
        0 2px 8px rgba(0,0,0,0.27);
      user-select: text;
      overflow: hidden;
    }
    .digit:before {
      content: "";
      position: absolute;
      inset: 0;
      background: var(--clock-glass-bg);
      pointer-events: none;
      z-index: 10;
    }

    /* Colon */
    .colon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: calc(var(--digit-w) * 0.3);
      font-size: calc(var(--digit-h) * 0.55);
      font-weight: 700;
      color: var(--colon-color);
      text-shadow: 0 2px 6px rgba(0,0,0,0.35);
      flex-shrink: 0;
      user-select: none;
      padding-top: 12px;
      letter-spacing: 0.08em;
    }

    /* --- Simple Timer (non-flip fallback) --- */
    #simpleTimer {
      display: none;
      text-align: center;
      font-weight: 700;
      font-size: clamp(120px, 12vw, 180px);
      letter-spacing: 0.1em;
      color: var(--simple-timer-color);
      text-shadow: 0 3px 8px rgba(0,0,0,0.25);
      user-select: none;
    }

    /* --------- Candle --------- */
    #candle-area {
      position: relative;
      height: 360px;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      transform: translateY(var(--candle-offset));
      user-select: none;
    }
    .candle-clip {
      position: relative;
      width: 140px;
      height: 330px;
      overflow: visible;
      display: flex;
      justify-content: center;
      align-items: flex-end;
    }
    .wax {
      position: relative;
      bottom: 0;
      width: 120px;
      height: 320px;
      background: radial-gradient(ellipse at center, var(--wax) 0%, #d7bfa4 90%);
      border-radius: 26px;
      box-shadow:
        inset 0 1px 14px rgba(255 255 255 / 0.8),
        0 8px 32px rgba(0,0,0,0.1);
      z-index: 1;
      user-select: none;
      transition: height 0.3s ease;
    }
    .wick {
      position: absolute;
      width: 5px;
      height: 28px;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(180deg, #2a1b1b, #000000);
      border-radius: 4px;
      z-index: 4;
      user-select: none;
    }
    .flame {
      position: absolute;
      top: 16px;
      left: 50%;
      width: 40px;
      height: 80px;
      transform: translateX(-50%);
      pointer-events: none;
      z-index: 6;
      user-select: none;
      animation: flicker 1s ease-in-out infinite alternate;
      filter: drop-shadow(0 0 8px rgba(255 140 0 / 0.6));
    }
    .flame-core {
      width: 100%;
      height: 100%;
      border-radius: 50% 50% 38% 38%;
      background:
        radial-gradient(ellipse at 50% 20%, #fff7b0 0%, #ffbb57 65%, transparent 90%);
      box-shadow:
        0 0 35px 12px #ff8f15cc,
        0 0 42px 18px #ff992f88,
        0 -16px 36px 6px #ffa22a88;
    }
    @keyframes flicker {
      0%, 100% { transform: translateX(-50%) scale(1) rotate(-0.9deg); }
      50% { transform: translateX(-52%) scale(1.05) rotate(0.7deg); }
    }

    /* --------- To-Do List --------- */
    #todo-panel {
      background: var(--todo-bg);
      border-radius: 16px;
      padding: 19px 20px 22px 20px;
      box-shadow: 0 12px 26px rgba(0,0,0,0.13);
      max-width: 350px;
      overflow-y: auto;
      color: #4b1c1c;
      user-select: text;
    }
    #todoTitle {
      margin: 0 0 8px 0;
      font-weight: 800;
      font-size: 19px;
      color: #3b1111;
      letter-spacing: 0.05em;
      border-bottom: 2px solid #ff8043;
      padding-bottom: 6px;
      user-select: none;
      font-family: Georgia, serif;
    }
    #todoList {
      margin: 0;
      padding-left: 18px;
      list-style-type: decimal;
      max-height: 58vh;
      overflow-y: auto;
      font-size: 15px;
    }
    #todoList li {
      margin-bottom: 8px;
      line-height: 1.4;
      color: #632b2b;
      user-select: all;
    }

    /* -------- Controls (settings) panel -------- */
    #controls {
      position: relative;
      max-width: 340px;
      background: rgba(255,255,255,0.15);
      border-radius: 18px;
      padding: 18px 24px;
      color: #4c1c1c;
      box-shadow: 0 12px 44px rgba(0,0,0,0.22);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      user-select: none;
      max-height: 70vh;
      overflow-y: auto;
      font-size: 14px;
      font-weight: 600;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }

    .card {
      margin-bottom: 22px;
    }
    .card label {
      font-weight: 700;
      font-size: 13px;
      color: #5b2d24;
      letter-spacing: 0.02em;
      margin-bottom: 6px;
      display: block;
      user-select:none;
    }
    .row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }
    input[type="number"], input[type="color"], input[type="file"] {
      flex: 1 1 auto;
      border-radius: 8px;
      border: 1.5px solid rgba(255 255 255 / 0.35);
      background: rgba(255 255 255 / 0.4);
      color: #511c1c;
      padding: 10px 14px;
      font-weight: 800;
      outline: none;
      font-size: 14px;
      box-shadow: 0 0 12px #ffa97344 inset;
      transition: border-color 0.25s ease;
      user-select: text;
    }
    input[type="number"]:focus, input[type="color"]:focus, input[type="file"]:focus {
      border-color: #ff8a1c;
      box-shadow: 0 0 12px #ffa973aa inset;
    }
    input[type="checkbox"] {
      width: 19px;
      height: 19px;
      accent-color: #ff7a00;
      cursor: pointer;
      user-select: none;
      flex-shrink: 0;
      transform: scale(1.15);
    }
    button {
      font-weight: 700;
      font-size: 14px;
      padding: 12px 20px;
      border-radius: 16px;
      border: none;
      background: linear-gradient(135deg, #ffad5e, #e67304);
      box-shadow: 0 7px 20px #dfa050af;
      color: #fff;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      flex-grow: 1;
      min-width: 120px;
      letter-spacing: 0.02em;
      font-family: 'Segoe UI', sans-serif;
    }
    button:hover {
      background: linear-gradient(135deg, #ffc37c, #ff9800);
      box-shadow: 0 12px 28px #efaf3a;
    }
    button:active {
      transform: scale(0.98);
    }

    /* --- Mobile sidebar and settings button --- */
    #mobileSidebar {
      position: fixed;
      top: 0; right: -340px;
      width: 320px;
      height: 100vh;
      background: rgba(255 255 255 / 0.15);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: -5px 0 24px rgba(0,0,0,0.25);
      transition: right 0.33s cubic-bezier(0.4,0,0.2,1);
      overflow-y: auto;
      padding: 28px 26px 36px 26px;
      z-index: 150;
      border-left: 1px solid rgba(255 255 255 / 0.25);
      border-radius: 0 0 0 18px;
      color: #6b3c2c;
      font-weight: 600;
      user-select: text;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }
    body.sidebar-open #mobileSidebar {
      right: 0;
    }
    #settingsToggle {
      position: fixed;
      bottom: 22px;
      right: 22px;
      z-index: 200;
      padding: 16px 28px;
      font-weight: 800;
      font-size: 17px;
      border-radius: 30px;
      border: none;
      background: linear-gradient(135deg, #f87f43, #d1540e);
      color: #fff;
      cursor: pointer;
      user-select: none;
      box-shadow:
        0 10px 24px rgba(255 126 49 / 0.68),
        inset 0 -6px 8px rgba(255 255 255 / 0.3);
      transition: background 0.22s ease;
      font-family: 'Segoe UI', sans-serif;
    }
    #settingsToggle:hover {
      background: linear-gradient(135deg, #ffa04a, #e5630d);
    }
    #settingsToggle:focus {
      outline-offset: 4px;
      outline: 3px solid #ffbd72;
    }

    @media (max-width: 880px) and (orientation: landscape) {
      #controls {
        display: none !important;
      }
      #settingsToggle {
        display: block !important;
      }
      .main {
        padding-bottom: 90px;
        grid-template-columns: 1fr minmax(160px, 1fr) 1fr;
        gap: 16px;
      }
      #todo-panel {
        max-width: 100%;
        overflow-wrap: break-word;
        font-size: 13px;
      }
    }
    @media (min-width: 881px), (orientation: portrait) {
      #settingsToggle {
        display: none !important;
      }
      #mobileSidebar {
        display: none !important;
      }
      #controls {
        display: block !important;
      }
    }


  </style>
</head>
<body>
  <div class="brand" aria-label="Brand name">MADE BY ANABRATA — V10</div>

  <main class="main" role="main">

    <section id="timer-container" aria-label="Timer" role="timer" aria-live="polite" aria-atomic="true">
      <div id="timer" aria-hidden="true"></div>
      <div id="simpleTimer" aria-live="assertive" style="display:none" aria-label="Simple Timer"></div>
    </section>

    <section id="todo-panel" aria-label="To-do list" role="list">
      <h4 id="todoTitle">To‑do</h4>
      <ol id="todoList" tabindex="0" aria-multiselectable="true" contenteditable="true" spellcheck="false" role="listbox" aria-live="polite" aria-label="Todos"></ol>
    </section>

    <section id="candle-area" aria-label="Candle">
      <div class="candle-clip" aria-hidden="true">
        <div class="wax" id="wax">
          <div class="wick" id="wick"></div>
        </div>
        <div class="flame" id="flame"><div class="flame-core"></div></div>
      </div>
    </section>

  </main>

  <!-- Desktop controls -->
  <aside id="controls" aria-label="Timer and appearance settings">
    <div class="card">
      <label for="hoursInput">Hours</label>
      <input id="hoursInput" type="number" min="0" max="99" value="0" aria-describedby="hoursDesc">
      <small id="hoursDesc">Set the number of hours</small>
    </div>
    <div class="card">
      <label for="minInput">Minutes</label>
      <input id="minInput" type="number" min="0" max="59" value="1" aria-describedby="minutesDesc">
      <small id="minutesDesc">Set the number of minutes</small>
    </div>
    <div class="card">
      <label for="secInput">Seconds</label>
      <input id="secInput" type="number" min="0" max="59" value="0" aria-describedby="secondsDesc">
      <small id="secondsDesc">Set the number of seconds</small>
    </div>
    <div class="card">
      <label><input type="checkbox" id="showHours" checked> Show hours</label>
      <label><input type="checkbox" id="showSeconds" checked> Show seconds</label>
      <label><input type="checkbox" id="useFlip" checked> Use flip clock style</label>
    </div>
    <div class="card">
      <button id="primaryBtn" aria-label="Start or pause timer">Start</button>
      <button id="resetBtn" aria-label="Reset timer">Reset</button>
      <button id="fsBtn" aria-label="Fullscreen toggle">Fullscreen</button>
    </div>
    <div class="card">
      <label for="bgAngle">Background gradient angle</label>
      <input id="bgAngle" type="number" min="0" max="360" value="135">
      <label for="bgC1">Color 1</label>
      <input id="bgC1" type="color" value="#50386a">
      <label for="bgC2">Color 2</label>
      <input id="bgC2" type="color" value="#a364a6">
      <label for="bgC3">Color 3</label>
      <input id="bgC3" type="color" value="#fabcaf">
    </div>
    <div class="card">
      <label for="todoColor">To‑do list text color</label>
      <input id="todoColor" type="color" value="#4b1c1c">
      <button id="todoApply">Apply</button>
      <button id="todoClear" title="Clear to transparent">Clear</button>
      <label><input type="checkbox" id="todoGlass"> Blur background effect</label>
    </div>
    <div class="card">
      <label>Media &amp; background</label>
      <button id="addMusicBtn">Add music</button>
      <input id="musicFiles" type="file" accept="audio/*" multiple style="display:none" />
      <button id="musicPrev" title="Previous">⏮</button>
      <button id="musicPlay" title="Play/Pause">▶</button>
      <button id="musicNext" title="Next">⏭</button>
      <label><input type="checkbox" id="musicLoop" checked> Loop</label>
      <span id="musicNow" style="font-size: 12px; opacity: 0.95; max-width: 230px; overflow:hidden; white-space: nowrap; text-overflow: ellipsis;"></span>
    </div>
    <div class="card">
      <label>Flip clock colors</label>
      <input id="clockC1" type="color" value="#fff" title="Panel 1 color">
      <input id="clockC2" type="color" value="#ffe6e3" title="Panel 2 color">
      <input id="clockC3" type="color" value="#ffb8b5" title="Panel 3 color">
      <input id="textColor" type="color" value="#3b0a0a" title="Digit color">
      <input id="colonColor" type="color" value="#873131" title="Colon color">
      <label><input type="checkbox" id="clockTransparent"> Transparent flip cards</label>
      <input id="simpleColor" type="color" value="#b94141" title="Simple timer color">
    </div>
    <div class="card">
      <label>Layout Options</label>
      <label><input type="checkbox" id="hideCandle"> Hide candle</label>
      <label><input type="checkbox" id="centerClock"> Center clock</label>
      <label><input type="checkbox" id="onlyCandle"> Only candle mode</label>
      <label><input type="checkbox" id="showTodo" checked> Show to‑do list</label>
    </div>
  </aside>

  <!-- Mobile settings sidebar -->
  <aside id="mobileSidebar" aria-label="Timer and appearance settings (mobile)"></aside>

  <button id="settingsToggle" aria-label="Open settings sidebar">Settings</button>

  <script>
    // Helper selectors
    const $ = s => document.querySelector(s);
    const $$ = s => [...document.querySelectorAll(s)];

    /* --- Swap controls to sidebar on mobile landscape --- */
    document.addEventListener('DOMContentLoaded', () => {
      const controls = $('#controls');
      const mobileSidebar = $('#mobileSidebar');
      if (controls && mobileSidebar) {
        mobileSidebar.innerHTML = controls.innerHTML;
      }
    });

    // Sidebar toggle
    const settingsToggle = $('#settingsToggle');
    const mobileSidebar = $('#mobileSidebar');

    settingsToggle.addEventListener('click', e => {
      e.stopPropagation();
      document.body.classList.toggle('sidebar-open');
      if (document.body.classList.contains('sidebar-open')) {
        mobileSidebar.setAttribute('aria-hidden', 'false');
        mobileSidebar.focus();
      } else {
        mobileSidebar.setAttribute('aria-hidden', 'true');
      }
    });

    // Click outside to close sidebar
    window.addEventListener('click', e => {
      if (document.body.classList.contains('sidebar-open') && !mobileSidebar.contains(e.target) && e.target !== settingsToggle) {
        document.body.classList.remove('sidebar-open');
        mobileSidebar.setAttribute('aria-hidden','true');
      }
    });

    // Escape closes sidebar
    window.addEventListener('keydown', e => {
      if (e.key === 'Escape' && document.body.classList.contains('sidebar-open')) {
        document.body.classList.remove('sidebar-open');
        mobileSidebar.setAttribute('aria-hidden','true');
      }
    });

    /* -------- Timer and flip clock logic -------- */

    // Create digit element for flip clock
    function createDigit(initial = '0') {
      const d = document.createElement('div');
      d.className = 'digit';
      d.dataset.value = initial;

      const top = document.createElement('div');
      top.className = 'top';
      const t = document.createElement('span');
      t.className = 'value';
      t.textContent = initial;
      top.appendChild(t);

      const bottom = document.createElement('div');
      bottom.className = 'bottom';
      const b = document.createElement('span');
      b.className = 'value';
      b.textContent = initial;
      bottom.appendChild(b);

      d.appendChild(top);
      d.appendChild(bottom);
      return d;
    }

    // Flip animation function
    function flipTo(digitEl, newVal) {
      const cur = digitEl.dataset.value || '0';
      if (cur === newVal) return;

      const topVal = digitEl.querySelector('.top .value');
      const botVal = digitEl.querySelector('.bottom .value');

      const topFlip = document.createElement('div');
      topFlip.className = 'top-flip';
      const t = document.createElement('span');
      t.className = 'value';
      t.textContent = cur;
      topFlip.appendChild(t);

      topVal.textContent = cur;
      botVal.textContent = cur;
      digitEl.appendChild(topFlip);

      topFlip.addEventListener('animationend', () => {
        topVal.textContent = newVal;
        topFlip.remove();

        const bottomFlip = document.createElement('div');
        bottomFlip.className = 'bottom-flip';
        const b = document.createElement('span');
        b.className = 'value';
        b.textContent = newVal;
        bottomFlip.appendChild(b);
        digitEl.appendChild(bottomFlip);

        bottomFlip.addEventListener('animationend', () => {
          botVal.textContent = newVal;
          digitEl.dataset.value = newVal;
          bottomFlip.remove();
        });
      });
    }

    // Build flip clock digits container
    function buildFlip(container, showH = true, showS = true) {
      container.innerHTML = '';
      const digits = [];

      const addDigit = () => {
        const d = createDigit('0');
        container.appendChild(d);
        digits.push(d);
      };
      const addColon = () => {
        const c = document.createElement('div');
        c.className = 'colon';
        c.textContent = ':';
        container.appendChild(c);
      };

      if (showH) {
        addDigit();
        addDigit();
        addColon();
      }
      addDigit();
      addDigit();
      if (showS) {
        addColon();
        addDigit();
        addDigit();
      }
      return digits;
    }

    // Convert seconds to time digits array
    function timeArray(sec, showH, showS) {
      let h = Math.floor(sec / 3600);
      let m = Math.floor((sec % 3600) / 60);
      let s = Math.max(0, sec % 60);
      h = Math.min(h, 99);

      const arr = [];
      if (showH) arr.push(...String(h).padStart(2, '0'));
      arr.push(...String(m).padStart(2, '0'));
      if (showS) arr.push(...String(s).padStart(2, '0'));
      return arr;
    }

    // Update the flip digits to current time
    function tickFlip(digits, sec, showH, showS) {
      const arr = timeArray(sec, showH, showS);
      digits.forEach((d, i) => {
        flipTo(d, arr[i] || '0');
      });
    }

    // Render simple digital timer text fallback
    function renderSimple(sec) {
      const showH = $('#showHours').checked;
      const showS = $('#showSeconds').checked;
      const out = showH
        ? `${String(Math.floor(sec / 3600)).padStart(2, '0')}:${String(
            Math.floor((sec % 3600) / 60)
          ).padStart(2, '0')}:${String(sec % 60).padStart(2, '0')}`
        : `${String(Math.floor(sec / 60)).padStart(2, '0')}:${String(sec % 60).padStart(2, '0')}`;
      $('#simpleTimer').textContent = out;
    }

    // Countdown state and loop
    const timerFlip = $('#timer');
    const timerSimple = $('#simpleTimer');
    let flipDigits = [];
    let useFlip = true;
    let totalSec = 0;
    let endAtMs = 0;
    let rafId = null;
    let lastWhole = -1;
    let running = false;
    let paused = false;
    let pauseRemainMs = 0;

    function safeBuildClock() {
      useFlip = $('#useFlip').checked;
      if (useFlip) {
        timerFlip.style.display = 'flex';
        timerSimple.style.display = 'none';
        flipDigits = buildFlip(timerFlip, $('#showHours').checked, $('#showSeconds').checked);
        tickFlip(flipDigits, 0, $('#showHours').checked, $('#showSeconds').checked);
      } else {
        timerFlip.style.display = 'none';
        timerSimple.style.display = 'block';
        renderSimple(0);
      }
    }

    function tickTimer(sec) {
      if (useFlip) {
        tickFlip(flipDigits, sec, $('#showHours').checked, $('#showSeconds').checked);
      } else {
        renderSimple(sec);
      }
    }

    function startCountdown() {
      const h = Math.max(0, parseInt($('#hoursInput').value));
      const m = Math.max(0, parseInt($('#minInput').value));
      const s = Math.max(0, Math.min(59, parseInt($('#secInput').value)));

      totalSec = h * 3600 + m * 60 + s;

      if (totalSec <= 0) {
        finishNow();
        return;
      }

      endAtMs = performance.now() + totalSec * 1000;
      lastWhole = Math.ceil(totalSec);
      running = true;
      paused = false;
      $('#primaryBtn').textContent = 'Stop';
      rafId = requestAnimationFrame(loop);
    }

    function loop(now) {
      if (!running) return;

      const remainMs = Math.max(0, endAtMs - now);
      const secWhole = Math.floor(remainMs / 1000);

      if (secWhole !== lastWhole) {
        tickTimer(secWhole);
        lastWhole = secWhole;
      }

      // Wax height and flame position updates here (if you want to add candle animation)

      if (remainMs <= 0) {
        finishNow();
        return;
      }
      rafId = requestAnimationFrame(loop);
    }

    function finishNow() {
      running = false;
      paused = false;
      cancelAnimationFrame(rafId);
      $('#primaryBtn').textContent = 'Start';
      tickTimer(0);
      // Fire any finish events (like showing congrats) here
    }

    // Button event handlers
    $('#primaryBtn').addEventListener('click', () => {
      if (!running && !paused) {
        startCountdown();
      } else if (running) {
        paused = true;
        running = false;
        cancelAnimationFrame(rafId);
        $('#primaryBtn').textContent = 'Resume';
      } else if (paused) {
        const now = performance.now();
        endAtMs = now + pauseRemainMs;
        lastWhole = Math.floor(pauseRemainMs / 1000);
        paused = false;
        running = true;
        $('#primaryBtn').textContent = 'Stop';
        rafId = requestAnimationFrame(loop);
      }
    });

    $('#resetBtn').addEventListener('click', () => {
      running = false; paused = false;
      cancelAnimationFrame(rafId);
      safeBuildClock();
      $('#primaryBtn').textContent = 'Start';
    });

    // Reflect color options live
    function applyGradient() {
      document.body.style.backgroundImage = `linear-gradient(135deg, ${$('#bgC1').value}, ${$('#bgC2').value}, ${$('#bgC3').value})`;
    }

    $('#bgC1').addEventListener('input', applyGradient);
    $('#bgC2').addEventListener('input', applyGradient);
    $('#bgC3').addEventListener('input', applyGradient);

    $('#todoApply').addEventListener('click', () => {
      document.documentElement.style.setProperty('--todo-bg', $('#todoColor').value);
      $('#todo-panel').classList.remove('todo-clear');
    });
    $('#todoClear').addEventListener('click', () => {
      document.documentElement.style.setProperty('--todo-bg', 'transparent');
      $('#todo-panel').classList.add('todo-clear');
    });
    $('#todoGlass').addEventListener('change', (e) => {
      $('#todo-panel').classList.toggle('todo-glass', e.target.checked);
    });

    // Flip clock colors set dynamically
    function restyleClockPanels() {
      document.documentElement.style.setProperty('--clock-c1', $('#clockC1').value);
      document.documentElement.style.setProperty('--clock-c2', $('#clockC2').value);
      document.documentElement.style.setProperty('--clock-c3', $('#clockC3').value);
      document.documentElement.style.setProperty('--clock-text', $('#textColor').value);
      document.documentElement.style.setProperty('--colon-color', $('#colonColor').value);
      document.documentElement.style.setProperty('--simple-timer-color', $('#simpleColor').value);
    }
    $$(
      '#clockC1,#clockC2,#clockC3,#textColor,#colonColor,#simpleColor'
    ).forEach((el) => {
      el.addEventListener('input', restyleClockPanels);
    });

    $('#showHours').addEventListener('change', () => {
      safeBuildClock();
    });
    $('#showSeconds').addEventListener('change', () => {
      safeBuildClock();
    });
    $('#useFlip').addEventListener('change', () => {
      safeBuildClock();
    });

    /* --- Initialize visuals --- */
    safeBuildClock();
    applyGradient();
    restyleClockPanels();

    // Init To-do example text
    const todoList = $('#todoList');
    todoList.innerHTML = '';
    const tasks = ['Sample task 1', 'Sample task 2'];
    tasks.forEach((text) => {
      const li = document.createElement('li');
      li.textContent = text;
      todoList.appendChild(li);
    });

  </script>
</body>
</html>
