<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Candle Timer</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #222;
      transition: background 0.3s;
      font-family: 'Comic Sans MS', sans-serif;
    }
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255,255,255,0.8);
      padding: 10px;
      border-radius: 8px;
      z-index: 10;
    }
    #controls label {
      display: block;
      margin: 5px 0;
    }
    #timer {
      margin-bottom: 40px;
    }
    .flip-card {
      display: inline-block;
      perspective: 1000px;
    }
    .digit {
      width: 60px;
      height: 80px;
      margin: 0 4px;
      position: relative;
      color: #fff;
      background: #000;
      border-radius: 6px;
      overflow: hidden;
      font-size: 60px;
      line-height: 80px;
      text-align: center;
      font-weight: bold;
      font-family: inherit;
    }
    .digit .top, .digit .bottom, .digit .back-top, .digit .back-bottom {
      position: absolute;
      width: 100%;
      height: 50%;
      left: 0;
      backface-visibility: hidden;
    }
    .digit .top {
      top: 0;
      border-bottom: 1px solid #333;
      transform-origin: bottom;
      z-index: 3;
    }
    .digit .back-top {
      top: 0;
      transform: rotateX(180deg);
      z-index: 2;
    }
    .digit .bottom {
      bottom: 0;
      border-top: 1px solid #333;
      transform-origin: top;
    }
    .digit .back-bottom {
      bottom: 0;
      transform: rotateX(0deg);
      z-index: 1;
    }
    .flip {
      animation: flip 0.6s ease-in-out forwards;
    }
    @keyframes flip {
      0% { transform: rotateX(0deg); }
      50% { transform: rotateX(-90deg); }
      100% { transform: rotateX(-180deg); }
    }
    #candle-container {
      position: relative;
      width: 80px;
      height: 200px;
      transition: transform 1s ease-in;
    }
    #candle {
      width: 80px;
      height: 200px;
      background: #fff;
      border-radius: 10px;
      position: relative;
      transition: background 0.3s;
    }
    #flame {
      position: absolute;
      top: -40px;
      left: 50%;
      transform: translateX(-50%);
      width: 30px;
      height: 60px;
      background: radial-gradient(circle at 50% 20%, #fffa90, #ff9a00 60%, transparent);
      border-radius: 50% 50% 30% 30%;
      filter: blur(2px);
      animation: flicker 0.2s infinite;
      transition: opacity 0.5s;
    }
    @keyframes flicker {
      0%,100% { transform: translateX(-50%) scale(1); opacity: 1; }
      50% { transform: translateX(-50%) scale(1.1); opacity: 0.8; }
    }
    #candle-out {
      display: none;
      position: absolute;
      top:0; left:0;
      width: 80px; height:200px;
      background: #ccc;
      border-radius: 10px;
      transform: rotate(45deg) translateY(-100%);
      opacity: 0.8;
    }
    footer {
      position: absolute;
      bottom: 10px;
      font-size: 14px;
      color: #ddd;
    }
  </style>
</head>
<body>
  <div id="controls">
    <label>
      Minutes:
      <input type="number" id="minInput" value="0" min="0" style="width:60px;" />
    </label>
    <label>
      Seconds:
      <input type="number" id="secInput" value="30" min="0" max="59" style="width:60px;" />
    </label>
    <label><input type="checkbox" id="toggleSec" checked /> Show Seconds</label>
    <label>
      Clock Color:
      <input type="color" id="colorPicker" value="#ffffff" />
    </label>
    <label>
      Background:
      <input type="color" id="bgPicker" value="#222222" />
    </label>
    <label>
      Candle Color:
      <input type="color" id="candleColorPicker" value="#ffffff" />
    </label>
    <label>
      Font:
      <select id="fontPicker">
        <option value="Comic Sans MS" selected>Comic Sans MS</option>
        <option value="Arial">Arial</option>
        <option value="Verdana">Verdana</option>
        <option value="Courier New">Courier New</option>
      </select>
    </label>
    <button id="startBtn">Start</button>
  </div>

  <div id="timer"></div>
  <div id="candle-container">
    <div id="candle"></div>
    <div id="flame"></div>
    <div id="candle-out"></div>
  </div>
  <footer>MADE BY ANABRATA</footer>

  <script>
    // Utility to create digit elements
    function createDigit() {
      const d = document.createElement('div');
      d.className = 'digit';
      ['top','back-top','bottom','back-bottom'].forEach(cls => {
        const part = document.createElement('div');
        part.className = cls;
        d.appendChild(part);
      });
      return d;
    }

    const timerEl = document.getElementById('timer');
    let digits = [];
    let totalSec = 0, remaining = 0, intervalId;

    // Initialize digits (MM:SS or MM)
    function setupDigits(showSec) {
      timerEl.innerHTML = '';
      digits = [];
      // minutes tens, minutes ones
      timerEl.appendChild(createDigit());
      timerEl.appendChild(createDigit());
      if (showSec) {
        const colon = document.createElement('span');
        colon.textContent = ':';
        colon.style.color = getComputedStyle(timerEl).color;
        colon.style.fontSize = '60px';
        timerEl.appendChild(colon);
        // seconds tens, seconds ones
        timerEl.appendChild(createDigit());
        timerEl.appendChild(createDigit());
      }
      digits = Array.from(timerEl.querySelectorAll('.digit'));
      updateDisplay(remaining);
    }

    // Update flip animation
    function flipTo(digit, newVal) {
      const [top, backTop, bottom, backBottom] = digit.children;
      const oldVal = top.textContent || '0';
      if (oldVal === newVal) return;
      backTop.textContent = oldVal;
      backBottom.textContent = newVal;
      bottom.textContent = newVal;
      digit.classList.add('flip');
      digit.addEventListener('animationend', () => {
        top.textContent = newVal;
        digit.classList.remove('flip');
      }, { once: true });
    }

    // Convert seconds to MMSS, update each digit
    function updateDisplay(sec) {
      const mins = Math.floor(sec / 60);
      const secs = sec % 60;
      const arr = remainingDisplay = [
        String(mins).padStart(2,'0'),
        ...(document.getElementById('toggleSec').checked
          ? [String(secs).padStart(2,'0')] : [])
      ].join('').split('');
      digits.forEach((d,i) => flipTo(d, arr[i] || '0'));
    }

    function tick() {
      if (remaining <= 0) {
        clearInterval(intervalId);
        // extinguish
        document.getElementById('flame').style.opacity = '0';
        // drop candle
        document.getElementById('candle').style.opacity = '0';
        document.getElementById('candle-out').style.display = 'block';
        document.getElementById('candle-container').style.transform = 'translateY(200px) rotate(20deg)';
        return;
      }
      remaining--;
      updateDisplay(remaining);
    }

    document.getElementById('startBtn').onclick = () => {
      clearInterval(intervalId);
      const mins = parseInt(document.getElementById('minInput').value) || 0;
      const secs = parseInt(document.getElementById('secInput').value) || 0;
      totalSec = mins*60 + secs;
      remaining = totalSec;
      setupDigits(document.getElementById('toggleSec').checked);
      intervalId = setInterval(tick, 1000);
    };

    // Controls reactions
    document.getElementById('toggleSec').onchange = () => setupDigits(!!remaining && document.getElementById('toggleSec').checked);
    document.getElementById('colorPicker').oninput = e => {
      timerEl.querySelectorAll('.digit, span').forEach(el => el.style.color = e.target.value);
    };
    document.getElementById('bgPicker').oninput = e => document.body.style.background = e.target.value;
    document.getElementById('candleColorPicker').oninput = e => document.getElementById('candle').style.background = e.target.value;
    document.getElementById('fontPicker').onchange = e => document.body.style.fontFamily = `'${e.target.value}', sans-serif`;
    
    // Initial setup
    setupDigits(true);
  </script>
</body>
</html>
