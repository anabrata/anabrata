<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Candle Timer â€” V10</title>
<style>
  /* Existing CSS styles here (same as your original code) */
  :root{
    /* Sizes */
    --digit-w: 120px;
    --digit-h: 170px;
    --digit-radius: 16px;
    --split-line: rgba(0,0,0,0.10);

    /* Spacing */
    --gap: clamp(24px, 5vw, 56px);

    /* Background gradient */
    --bg-angle: 135deg;
    --bg-c1: #3a1c71;
    --bg-c2: #d76d77;
    --bg-c3: #ffaf7b;

    /* Flip clock colors (with glass overlay) */
    --clock-c1: #ffffff;
    --clock-c2: #ffffff;
    --clock-c3: #ffffff;
    --clock-text: #000000;
    --colon-color: #ffffff;
    --clock-glass-bg: rgba(255,255,255,0.06);
    --clock-glass-border: rgba(255,255,255,0.18);

    /* Simple (nonâ€‘flip) clock color */
    --simple-color: #ffffff;

    /* Candle */
    --wax: #f2e4c7;
    --wick: #1b1b1b;

    /* Layout tweak */
    --candle-offset: 18px;

    /* Toâ€‘do base bg (transparent by default) */
    --todo-bg: transparent;
  }

  /* [Your existing CSS styling here unchanged for layout, clock styles, candle, controls, overlays, etc.] */

  /* Transparent mode for flip cards */
  .clock-transparent .digit{
    background: transparent !important;
    border-color: rgba(255,255,255,.28) !important;
    box-shadow: 0 10px 28px rgba(0,0,0,.22) !important;
    backdrop-filter: none !important;
  }
  .clock-transparent .digit:before{ background: transparent !important; }
  .clock-transparent .digit .top{ border-bottom:1px solid rgba(255,255,255,.25); }
  .clock-transparent .digit .bottom{ border-top:1px solid rgba(255,255,255,.25); }

  /* [Rest of your original CSS unchanged] */
</style>
</head>
<body>
  <div class="brand">MADE BY ANABRATA â€” V10</div>

  <div class="main" id="main">
    <!-- Timer -->
    <section id="timer-container" aria-label="Timer">
      <div id="timer"></div>
      <div id="simpleTimer">00:00</div>
    </section>

    <!-- Toâ€‘do -->
    <section id="todo-panel" class="todo-clear" aria-label="Toâ€‘do list">
      <h4 id="todoTitle">Toâ€‘do</h4>
      <ol id="todoList"></ol>
    </section>

    <!-- Candle -->
    <section id="candle-area" aria-label="Candle">
      <div class="candle-clip">
        <div class="candle-wrap" id="candleWrap">
          <div class="wax" id="wax">
            <div class="waxTop"></div>
            <div class="wick" id="wick"></div>
          </div>
          <div class="stub" id="stub"></div>
        </div>
      </div>
      <div class="flame" id="flame"><div class="flame-core"></div></div>
    </section>
  </div>

  <!-- Controls -->
  <div id="controls">
    <!-- Your controls HTML as in original file -->
  </div>

  <!-- 3-2-1 overlay -->
  <div id="countOverlay" aria-hidden="true">
    <div id="countInner" class="pop">3</div>
  </div>

  <!-- Congrats overlay with balloons -->
  <div id="congrats" aria-modal="true" role="dialog">
    <div id="cgCard">
      <h2 id="cgTitle">Congratulations!</h2>
      <p id="cgMsg">Timer complete â€” great focus! ðŸŽ‰</p>
      <button id="cgClose">Close</button>
    </div>
    <!-- Balloons here -->
  </div>

<script>
  const $ = (s) => document.querySelector(s);

  /* ---------- Utilities ---------- */
  function afterNextPaint(cb){
    requestAnimationFrame(() => requestAnimationFrame(cb));
  }

  /* [Other utility functions and initial setup as your original code] */

  /* ---------- Flip clock ---------- */
  function createDigit(initial = "0"){
    const d = document.createElement("div");
    d.className = "digit";
    d.dataset.value = initial;

    const top = document.createElement("div");
    top.className = "top";
    const t = document.createElement("span");
    t.className = "value";
    t.textContent = initial;
    top.appendChild(t);

    const bottom = document.createElement("div");
    bottom.className = "bottom";
    const b = document.createElement("span");
    b.className = "value";
    b.textContent = initial;
    bottom.appendChild(b);

    d.appendChild(top);
    d.appendChild(bottom);
    return d;
  }

  // Modified flipTo function to fix latency on transparent flip cards
  function flipTo(digitEl, newVal){
    const cur = digitEl.dataset.value || "0";
    if (cur === newVal) return;

    const topVal = digitEl.querySelector(".top .value");
    const botVal = digitEl.querySelector(".bottom .value");

    // Remove old animation elements if any to prevent buildup
    const oldTopFlip = digitEl.querySelector(".top-flip");
    if(oldTopFlip) oldTopFlip.remove();
    const oldBottomFlip = digitEl.querySelector(".bottom-flip");
    if(oldBottomFlip) oldBottomFlip.remove();

    const topFlip = document.createElement("div");
    topFlip.className = "top-flip";
    const t = document.createElement("span");
    t.className = "value";
    t.textContent = cur;
    topFlip.appendChild(t);

    topVal.textContent = cur;
    botVal.textContent = cur;
    digitEl.appendChild(topFlip);

    topFlip.addEventListener("animationend", () => {
      topVal.textContent = newVal;
      topFlip.remove();
      const bottomFlip = document.createElement("div");
      bottomFlip.className = "bottom-flip";
      const b = document.createElement("span");
      b.className = "value";
      b.textContent = newVal;
      bottomFlip.appendChild(b);
      digitEl.appendChild(bottomFlip);
      bottomFlip.addEventListener("animationend", () => {
        botVal.textContent = newVal;
        digitEl.dataset.value = newVal;
        bottomFlip.remove();
      });
    });
  }

  /* [Rest of your existing JS code unchanged, including building the clock, ticking, countdown, candle control, to-do list, music, controls, overlays, fullscreen, etc.] */

  /* ---------- Init ---------- */
  (function boot(){
    /* original initialization code */
  })();
</script>
</body>
</html>
