<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Thank You • Donate</title>
  <style>
    :root{
      --card-bg: rgba(255,255,255,0.08);
      --card-br: 16px;
      --text: #ffffff;
      --accent: #ffdd57;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      color: var(--text);
      font: 500 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      background: linear-gradient(120deg, #1e1b4b, #312e81, #7c3aed, #0ea5e9, #22c55e, #f59e0b);
      background-size: 400% 400%;
      animation: bgMove 24s ease-in-out infinite;
      display: grid;
      place-items: center;
      overflow: hidden;
    }
    .wrap { position: relative; width: min(960px, 92vw); padding: clamp(20px, 3.5vw, 36px); text-align: center; z-index: 1; }
    .title {
      margin: 0 0 0.15em 0; font-size: clamp(40px, 7vw, 72px); line-height: 1.05; letter-spacing: 0.5px;
      background: linear-gradient(90deg, #fff, #ffe29a, #ffd166, #fff); background-size: 300% 100%;
      -webkit-background-clip: text; background-clip: text; color: transparent; animation: shine 6s linear infinite;
      text-wrap: balance;
    }
    .subtitle { margin: 0 0 22px 0; font-size: clamp(16px, 2.5vw, 22px); opacity: 0.9; }
    .card {
      margin-inline: auto; width: min(440px, 84vw); padding: 18px 18px 24px; border-radius: var(--card-br);
      background: var(--card-bg); border: 1px solid rgba(255,255,255,0.15);
      box-shadow: 0 10px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.15);
      backdrop-filter: blur(12px) saturate(120%); -webkit-backdrop-filter: blur(12px) saturate(120%);
      transition: transform 0.6s ease, box-shadow 0.6s ease;
    }
    .card:hover { transform: translateY(-4px); }
    .qr {
      display: block; width: 100%; height: auto; border-radius: 8px; background: #fff;
      box-shadow: 0 8px 24px rgba(0,0,0,0.35), 0 0 30px 8px rgba(255,221,87,0.25);
      animation: pulse 2.6s ease-in-out infinite;
    }
    .controls { margin-top: 14px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
    .btn {
      appearance: none; border: 1px solid rgba(255,255,255,0.2); color: #fff; background: rgba(0,0,0,0.35);
      padding: 8px 14px; border-radius: 999px; cursor: pointer; font-weight: 600; letter-spacing: 0.3px;
      backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);
    }
    .note { margin-top: 16px; font-size: 14px; opacity: 0.85; }
    .aura { position: absolute; inset: -30vmax; background: radial-gradient( farthest-side, rgba(255,255,255,0.14), transparent 60% ); filter: blur(60px); z-index: 0; pointer-events: none; animation: auraFloat 18s ease-in-out infinite alternate; }
    #confetti { position: fixed; inset: 0; z-index: 0; pointer-events: none; }

    @keyframes bgMove { 0% {background-position:0% 50%} 50% {background-position:100% 50%} 100% {background-position:0% 50%} }
    @keyframes shine { 0% {background-position:0% 50%} 100% {background-position:300% 50%} }
    @keyframes pulse { 0%,100% {box-shadow:0 8px 24px rgba(0,0,0,0.35), 0 0 0 0 rgba(255,221,87,0.0)} 50% {box-shadow:0 10px 28px rgba(0,0,0,0.45), 0 0 30px 8px rgba(255,221,87,0.35)} }
    @keyframes auraFloat { from {transform:translateY(-2%) rotate(0)} to {transform:translateY(2%) rotate(6deg)} }
    @media (prefers-reduced-motion: reduce) { * { animation: none !important; transition: none !important; } }
  </style>
</head>
<body>
  <canvas id="confetti" aria-hidden="true"></canvas>

  <div class="wrap">
    <div class="aura"></div>

    <h1 class="title">Thank&nbsp;You!</h1>
    <p class="subtitle">Scan the QR to donate and help this project grow.</p>

    <section class="card" aria-label="Donation QR Code">
      <!-- This <img> is filled from localStorage or from a chosen file -->
      <img id="qr" class="qr" alt="Donation QR code" />
      <div class="controls">
        <button class="btn" id="pickBtn" type="button">Set / Change QR</button>
        <button class="btn" id="clearBtn" type="button">Clear Saved QR</button>
      </div>
      <input id="file" type="file" accept="image/*" hidden />
    </section>

    <p class="note">Every contribution makes a difference — thank you for the support.</p>
  </div>

  <script>
    (function () {
      // Respect users who prefer reduced motion (confetti disabled)
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      // Load saved QR (Data URL) if present
      const img = document.getElementById('qr');
      const saved = localStorage.getItem('qrDataURL');
      if (saved) img.src = saved;

      // File picker logic: read as Data URL then persist
      const fileInput = document.getElementById('file');
      document.getElementById('pickBtn').addEventListener('click', () => fileInput.click());
      fileInput.addEventListener('change', () => {
        const f = fileInput.files && fileInput.files;
        if (!f) return;
        if (!f.type.startsWith('image/')) { alert('Please choose an image file.'); return; }

        // Fast preview with object URL, then persist as Data URL
        const objURL = URL.createObjectURL(f);   // preview
        img.src = objURL;

        const reader = new FileReader();
        reader.onload = () => {
          try {
            localStorage.setItem('qrDataURL', reader.result);
          } catch (e) {
            console.warn('Could not persist QR (storage disabled or full).', e);
          }
          URL.revokeObjectURL(objURL);
        };
        reader.readAsDataURL(f);
      });

      document.getElementById('clearBtn').addEventListener('click', () => {
        localStorage.removeItem('qrDataURL');
        img.removeAttribute('src');
      });

      // Lightweight confetti (skipped for reduced motion)
      if (!prefersReduced) {
        const canvas = document.getElementById('confetti');
        const ctx = canvas.getContext('2d', { alpha: true });
        let W, H, pieces = [], tick = 0;

        function resize(){ W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
        addEventListener('resize', resize, { passive: true }); resize();

        function rand(a,b){ return Math.random()*(b-a)+a; }
        function piece(){
          const colors=['#ffd166','#06d6a0','#118ab2','#ef476f','#ffffff'];
          return { x:rand(0,W), y:rand(-H,0), w:rand(6,12), h:rand(8,16),
                   vy:rand(1.2,2.2), vx:rand(-0.6,0.6), r:rand(0,Math.PI*2),
                   vr:rand(-0.05,0.05), color:colors[(Math.random()*colors.length)|0], a:rand(0.75,1) };
        }
        for(let i=0;i<130;i++) pieces.push(piece());

        function draw(p){ ctx.save(); ctx.globalAlpha=p.a; ctx.translate(p.x,p.y); ctx.rotate(p.r);
          ctx.fillStyle=p.color; ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h); ctx.restore(); }

        function step(){
          ctx.clearRect(0,0,W,H); tick++;
          if (tick%3===0 && pieces.length<180) pieces.push(piece());
          for(let i=pieces.length-1;i>=0;i--){
            const p=pieces[i]; p.x+=p.vx; p.y+=p.vy; p.r+=p.vr; draw(p);
            if (p.y-20>H) { pieces[i]=piece(); pieces[i].y=-20; }
          }
          requestAnimationFrame(step);
        }
        requestAnimationFrame(step);
      }
    }());
  </script>
</body>
</html>
