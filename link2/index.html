<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>YouTube Player with Quality Selector (No Download)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, Arial, sans-serif; margin: 2rem; }
    .row { display: flex; gap: 0.75rem; flex-wrap: wrap; align-items: center; }
    input[type="url"] { flex: 1 1 420px; padding: 0.6rem; font-size: 1rem; }
    select, button { padding: 0.6rem; font-size: 1rem; }
    #player { margin-top: 1rem; aspect-ratio: 16/9; width: 100%; max-width: 960px; }
    #meta { margin-top: 0.75rem; font-size: 0.95rem; opacity: 0.85; }
    .pill { display:inline-block; padding:0.2rem 0.5rem; border:1px solid currentColor; border-radius:999px; margin-right:0.25rem; font-size:0.85rem; }
  </style>
</head>
<body>
  <h1>YouTube Player with Quality Selector (No Download)</h1>

  <div class="row">
    <input id="url" type="url" placeholder="Paste YouTube URL or 11-char video ID" />
    <button id="loadBtn" type="button">Load</button>
    <label for="quality">Quality:</label>
    <select id="quality">
      <option value="auto" selected>Auto</option>
      <option value="highres">Highres (max)</option>
      <option value="hd1080">1080p</option>
      <option value="hd720">720p</option>
      <option value="large">480p</option>
      <option value="medium">360p</option>
      <option value="small">240p</option>
    </select>
    <button id="applyQ" type="button">Apply quality</button>
  </div>

  <div id="meta"></div>
  <div id="player"></div>

  <script>
    // Load the IFrame Player API
    (function loadYT() {
      const s = document.createElement('script');
      s.src = "https://www.youtube.com/iframe_api";
      document.head.appendChild(s);
    })();

    let player = null;
    let currentVideoId = null;

    function onYouTubeIframeAPIReady() {
      // Player will be created lazily when a URL is loaded
    }

    function extractVideoId(input) {
      const raw = (input || "").trim();
      // If it's already an 11-char ID
      if (/^[a-zA-Z0-9_-]{11}$/.test(raw)) return raw;
      try {
        const u = new URL(raw);
        if (u.hostname === "youtu.be") {
          const id = u.pathname.slice(1).split("/");
          if (id) return id;
        }
        const v = u.searchParams.get("v");
        if (v && /^[a-zA-Z0-9_-]{11}$/.test(v)) return v;
        const parts = u.pathname.split("/").filter(Boolean);
        const eIdx = parts.indexOf("embed");
        if (eIdx >= 0 && parts[eIdx + 1] && /^[a-zA-Z0-9_-]{11}$/.test(parts[eIdx + 1])) return parts[eIdx + 1];
        const sIdx = parts.indexOf("shorts");
        if (sIdx >= 0 && parts[sIdx + 1] && /^[a-zA-Z0-9_-]{11}$/.test(parts[sIdx + 1])) return parts[sIdx + 1];
      } catch { /* not a URL, fallthrough */ }
      return null;
    }

    function ensurePlayer() {
      if (player) return;
      player = new YT.Player('player', {
        width: '100%',
        height: '100%',
        videoId: null,
        playerVars: {
          rel: 0,
          modestbranding: 1,
          playsinline: 1
        },
        events: {
          onReady: onPlayerReady,
          onPlaybackQualityChange: onPlaybackQualityChange,
          onStateChange: onPlayerStateChange
        }
      });
    }

    function onPlayerReady() {
      updateQualitiesUI();
    }

    function onPlaybackQualityChange(e) {
      updateQualitiesUI();
    }

    function onPlayerStateChange() {
      updateQualitiesUI();
    }

    function updateQualitiesUI() {
      if (!player) return;
      const avail = (player.getAvailableQualityLevels && player.getAvailableQualityLevels()) || [];
      const qualitySel = document.getElementById('quality');
      // Enable options only if available (except Auto)
      for (const opt of qualitySel.options) {
        if (opt.value === 'auto') { opt.disabled = false; continue; }
        opt.disabled = avail.length ? !avail.includes(opt.value) : false;
      }
      const meta = document.getElementById('meta');
      const curQ = player.getPlaybackQuality ? player.getPlaybackQuality() : 'auto';
      meta.innerHTML = `
        <span class="pill">Current: ${curQ || 'auto'}</span>
        <span class="pill">Available: ${avail.join(', ') || 'unknown'}</span>
      `;
    }

    async function loadVideoFromInput() {
      const url = document.getElementById('url').value;
      const id = extractVideoId(url);
      if (!id) {
        alert("Please paste a valid YouTube URL or 11-character video ID.");
        return;
      }
      currentVideoId = id;
      ensurePlayer();
      // Load with suggested quality based on dropdown (if not auto)
      const q = document.getElementById('quality').value;
      const payload = { videoId: id };
      if (q && q !== 'auto') payload.suggestedQuality = q;
      player.loadVideoById(payload);
    }

    function applyQuality() {
      if (!player || !currentVideoId) return;
      const q = document.getElementById('quality').value;
      if (q === 'auto') {
        // Let player auto-select; reload without suggestion
        const t = Math.floor(player.getCurrentTime() || 0);
        player.loadVideoById({ videoId: currentVideoId, startSeconds: t });
        return;
      }
      // Try to set directly, then fall back to reloading with a suggestion
      try { player.setPlaybackQuality && player.setPlaybackQuality(q); } catch {}
      const t = Math.floor(player.getCurrentTime() || 0);
      // Fallback: reload with suggestedQuality to hint the player
      player.loadVideoById({ videoId: currentVideoId, startSeconds: t, suggestedQuality: q });
    }

    document.getElementById('loadBtn').addEventListener('click', loadVideoFromInput);
    document.getElementById('applyQ').addEventListener('click', applyQuality);
    document.getElementById('quality').addEventListener('change', () => {
      // Optionally auto-apply on change:
      // applyQuality();
    });
  </script>
</body>
</html>
